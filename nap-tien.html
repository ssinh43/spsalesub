<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Nạp tiền - Chuyển khoản</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg fixed-top navbar-3d">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="images/logo.png" width="36" height="36" alt="logo" class="me-2">
      <strong>SPSALESUB</strong>
    </a>
    <div class="collapse navbar-collapse" id="menu">
      <div class="ms-auto d-flex gap-2">
        <a href="login.html" id="navbar-login-btn" class="btn btn-outline-order-3d">Đăng Nhập</a>
        <a href="register.html" id="navbar-signup-btn" class="btn btn-outline-order-3d" style="display:none">Đăng Ký</a>
        <a href="dathang.html" id="navbar-order-btn" class="btn btn-order-3d" style="display:none">Đặt hàng</a>
      </div>
    </div>
  </div>
</nav>

<main class="container" style="padding-top:100px; padding-bottom:60px;">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="row g-4">

        <!-- LEFT: Bank Details (3 cols equivalent small) -->
        <div class="col-lg-3">
          <div class="card-3d h-100">
            <div class="card-header-3d"><h6 class="mb-0"><i class="bi bi-bank"></i> Thông tin chuyển khoản</h6></div>
            <div class="card-body-3d">
              <p class="mb-2">Chọn ngân hàng và sao chép thông tin để chuyển khoản.</p>

              <div class="list-group">
                <label class="list-group-item d-flex align-items-start" style="cursor:pointer;">
                  <input class="form-check-input me-2 bank-radio" name="bank" type="radio" value="vietcombank" checked>
                  <div>
                    <div style="font-weight:700">Vietcombank</div>
                    <small>Chi nhánh: Nghệ An</small>
                  </div>
                </label>

                <label class="list-group-item d-flex align-items-start" style="cursor:pointer;">
                  <input class="form-check-input me-2 bank-radio" name="bank" type="radio" value="acb">
                  <div>
                    <div style="font-weight:700">ACB</div>
                    <small>Chi nhánh: Nghệ An</small>
                  </div>
                </label>

                <label class="list-group-item d-flex align-items-start" style="cursor:pointer;">
                  <input class="form-check-input me-2 bank-radio" name="bank" type="radio" value="techcombank">
                  <div>
                    <div style="font-weight:700">Techcombank</div>
                    <small>Chi nhánh: Nghệ An</small>
                  </div>
                </label>
              </div>

              <hr>

              <div id="bank-details">
                <!-- populated by JS -->
              </div>

              <div class="mt-3 d-grid gap-2">
                <button id="copy-account" class="btn btn-outline-order-3d btn-sm">Sao chép số tài khoản</button>
                <button id="copy-name" class="btn btn-outline-order-3d btn-sm">Sao chép tên chủ tài khoản</button>
              </div>
            </div>
          </div>
        </div>

        <!-- CENTER: Deposit form (5 cols equivalent) -->
        <div class="col-lg-5">
          <div class="card-3d h-100">
            <div class="card-header-3d"><h5 class="mb-0"><i class="bi bi-cash-stack"></i> Nạp tiền bằng chuyển khoản</h5></div>
            <div class="card-body-3d">

              <form id="deposit-form">
                <div class="mb-3">
                  <label class="form-label-3d">Số tiền nạp (VND)</label>
                  <input type="number" id="amount" class="form-control-3d" min="10000" placeholder="VD: 100000" required>
                  <small class="text-muted">Tối thiểu 10,000 VND</small>
                </div>

                <div class="mb-3">
                  <label class="form-label-3d">Tham chiếu (mã thanh toán)</label>
                  <div class="input-group">
                    <input type="text" class="form-control-3d" id="reference" readonly>
                    <button type="button" id="regen-ref" class="btn btn-outline-order-3d">Tạo mã mới</button>
                  </div>
                  <small class="text-muted">Hãy nhập mã này vào nội dung chuyển khoản để tự động đối soát.</small>
                </div>

                <div class="mb-3">
                  <label class="form-label-3d">Ghi chú</label>
                  <textarea id="note" class="form-control-3d" rows="2" placeholder="(tuỳ chọn)"></textarea>
                </div>

                <div class="mb-3 text-center">
                  <button type="submit" class="btn btn-order-3d btn-lg w-100">Tôi đã chuyển tiền</button>
                </div>

                <div id="deposit-message" style="display:none"></div>
              </form>

            </div>
          </div>
        </div>

        <!-- RIGHT 1: Quick actions / support (2 cols) -->
        <div class="col-lg-2">
          <div class="card-3d h-100">
            <div class="card-header-3d"><h6 class="mb-0">Hướng dẫn nhanh</h6></div>
            <div class="card-body-3d">
              <ol style="padding-left:16px;">
                <li>Sao chép thông tin ngân hàng bên trái.</li>
                <li>Chuyển khoản bằng Internet Banking/Mobile.</li>
                <li>Nhập <strong>mã tham chiếu</strong> vào nội dung chuyển khoản.</li>
                <li>Nhấn "Tôi đã chuyển tiền" để gửi thông báo.</li>
              </ol>

              <hr>
              <p class="mb-1">Hỗ trợ:</p>
              <a href="#" class="btn btn-outline-order-3d btn-sm w-100">Mở ticket</a>
            </div>
          </div>
        </div>

        <!-- RIGHT 2: Recent pending deposits (2 cols) -->
        <div class="col-lg-2">
          <div class="card-3d h-100">
            <div class="card-header-3d"><h6 class="mb-0">Giao dịch thành công</h6></div>
            <div class="card-body-3d">
              <ul id="pending-list" style="padding-left:0; list-style:none; margin:0;">
                <!-- pending items -->
              </ul>
              <div class="mt-3">
                <button id="clear-history" class="btn btn-outline-order-3d btn-sm w-100">Xóa lịch sử</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</main>

<footer class="footer-3d mt-4">
  <div class="container text-center py-3">
    <small>&copy; 2026 spsalesub.com</small>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/auth.js"></script>
<script>
// Bank data
const banks = {
  vietcombank: {name:'Ngân hàng TMCP Ngoại thương Việt Nam (Vietcombank)', account:'0123456789', owner:'CÔNG TY SPSALESUB', branch:'Chi nhánh Hà Nội'},
  acb: {name:'Ngân hàng ACB', account:'0987654321', owner:'CÔNG TY SPSALESUB', branch:'Chi nhánh TP.HCM'},
  techcombank: {name:'Ngân hàng Techcombank', account:'0223344556', owner:'CÔNG TY SPSALESUB', branch:'Chi nhánh Hà Nội'}
};

function renderBankDetails(key){
  const data = banks[key] || banks.vietcombank;
  const html = `
    <div style="font-size:13px;">\n      <div style=\"font-weight:700;margin-bottom:6px;\">${data.name}</div>\n      <div><small>Chi nhánh: ${data.branch}</small></div>\n      <div style=\"margin-top:8px;\"><strong>Số tài khoản:</strong> <span id=\"acc-number\">${data.account}</span></div>\n      <div style=\"margin-top:6px;\"><strong>Chủ TK:</strong> <span id=\"acc-owner\">${data.owner}</span></div>\n    </div>
  `;
  document.getElementById('bank-details').innerHTML = html;
}

// initialize
document.querySelectorAll('.bank-radio').forEach(r=> r.addEventListener('change', e=> renderBankDetails(e.target.value)));
renderBankDetails('vietcombank');

// copy buttons
document.getElementById('copy-account').addEventListener('click', ()=>{
  const v = document.getElementById('acc-number') || document.getElementById('acc-number');
  const text = document.querySelector('#bank-details #acc-number')?.innerText || '';
  navigator.clipboard.writeText(text).then(()=> alert('Số tài khoản đã được sao chép'));
});
document.getElementById('copy-name').addEventListener('click', ()=>{
  const text = document.querySelector('#bank-details #acc-owner')?.innerText || '';
  navigator.clipboard.writeText(text).then(()=> alert('Tên chủ tài khoản đã được sao chép'));
});

// reference generator
function genRef(){
  return 'REF'+Math.random().toString(36).substring(2,9).toUpperCase();
}
const refInput = document.getElementById('reference');
refInput.value = genRef();
document.getElementById('regen-ref').addEventListener('click', ()=> refInput.value = genRef());

// pending storage
function loadPending(){
  const list = JSON.parse(localStorage.getItem('pending_deposits')||'[]');
  const ul = document.getElementById('pending-list'); ul.innerHTML = '';
  if(list.length===0){ ul.innerHTML = '<div class="text-muted">Không có giao dịch thành công</div>'; return; }
  list.slice().reverse().forEach(p=>{
    const li = document.createElement('li');
    li.style.marginBottom='8px';
    li.innerHTML = `<div style="font-size:13px;">${p.amount.toLocaleString('vi-VN')}đ — <strong>${p.reference}</strong><div style=\"font-size:11px;color:#b8b8b8\">${p.bank} — ${new Date(p.time).toLocaleString()}</div></div>`;
    ul.appendChild(li);
  });
}
loadPending();

// form submit
document.getElementById('deposit-form').addEventListener('submit', function(e){
  e.preventDefault();
  const amount = Number(document.getElementById('amount').value);
  if(!amount || amount < 10000){ alert('Số tiền không hợp lệ (tối thiểu 10,000 VND)'); return; }
  const bank = document.querySelector('.bank-radio:checked')?.value || 'vietcombank';
  const reference = document.getElementById('reference').value || genRef();
  const note = document.getElementById('note').value || '';

  const pending = JSON.parse(localStorage.getItem('pending_deposits')||'[]');
  pending.push({bank, amount, reference, note, time: Date.now()});
  localStorage.setItem('pending_deposits', JSON.stringify(pending));

  const msg = document.getElementById('deposit-message');
  msg.style.display = 'block';
  msg.innerHTML = `<div class=\"alert alert-success\">Gửi yêu cầu nạp <strong>${amount.toLocaleString('vi-VN')}đ</strong>. Vui lòng chuyển tiền tới tài khoản hiển thị và nhập mã <strong>${reference}</strong> vào phần nội dung chuyển khoản. Chúng tôi sẽ đối soát tự động khi nhận được.</div>`;
  loadPending();
});

// clear history handler
document.getElementById('clear-history').addEventListener('click', function(){
  if(!confirm('Bạn có chắc muốn xóa toàn bộ lịch sử giao dịch không?')) return;
  localStorage.removeItem('pending_deposits');
  loadPending();
  alert('Đã xóa lịch sử giao dịch.');
});
</script>
</body>
</html>